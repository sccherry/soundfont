{"version":3,"sources":["webpack:///webpack/bootstrap","webpack:///./src/_data/soundfonts.js","webpack:///./src/scripts/lib/storage.js","webpack:///./src/scripts/lib/httpFetch.js","webpack:///./src/scripts/lib/Util.js","webpack:///./src/scripts/lib/soundfont.worker.js"],"names":["installedModules","__webpack_require__","moduleId","exports","module","i","l","modules","call","m","c","d","name","getter","o","Object","defineProperty","enumerable","get","r","Symbol","toStringTag","value","t","mode","__esModule","ns","create","key","bind","n","object","property","prototype","hasOwnProperty","p","s","version","upgrade","storage","db","soundfonts","forEach","soundfont","createObjectStore","Promise","resolve","reject","request","indexedDB","open","onupgradeneeded","e","result","oldVersion","newVersion","transaction","onerror","target","onsuccess","httpFetch","url","method","responseType","xhr","XMLHttpRequest","onreadystatechange","readyState","DONE","status","response","send","PITCH_CLASSES","decodeBase64","base64","raw","atob","len","length","bytes","Uint8Array","charCodeAt","buffer","pitchToMIDI","octave","pitch","noteToMIDI","note","parseInt","slice","indexOf","fetchSoundfont","options","instrument","format","nameToUrl","then","text","data","begin","end","lastIndexOf","JSON","parse","midiJsToJson","memoizedSoundfont","callback","storeName","buffers","Map","split","set","soundfontToArrayBuffer","obj","entries","toMap","returnFn","objectStore","getFromStorage","store","oncomplete","add","addToStorage","onmessage","postMessage"],"mappings":"aACE,IAAIA,EAAmB,GAGvB,SAASC,EAAoBC,GAG5B,GAAGF,EAAiBE,GACnB,OAAOF,EAAiBE,GAAUC,QAGnC,IAAIC,EAASJ,EAAiBE,GAAY,CACzCG,EAAGH,EACHI,GAAG,EACHH,QAAS,IAUV,OANAI,EAAQL,GAAUM,KAAKJ,EAAOD,QAASC,EAAQA,EAAOD,QAASF,GAG/DG,EAAOE,GAAI,EAGJF,EAAOD,QAKfF,EAAoBQ,EAAIF,EAGxBN,EAAoBS,EAAIV,EAGxBC,EAAoBU,EAAI,SAASR,EAASS,EAAMC,GAC3CZ,EAAoBa,EAAEX,EAASS,IAClCG,OAAOC,eAAeb,EAASS,EAAM,CAAEK,YAAY,EAAMC,IAAKL,KAKhEZ,EAAoBkB,EAAI,SAAShB,GACX,oBAAXiB,QAA0BA,OAAOC,aAC1CN,OAAOC,eAAeb,EAASiB,OAAOC,YAAa,CAAEC,MAAO,WAE7DP,OAAOC,eAAeb,EAAS,aAAc,CAAEmB,OAAO,KAQvDrB,EAAoBsB,EAAI,SAASD,EAAOE,GAEvC,GADU,EAAPA,IAAUF,EAAQrB,EAAoBqB,IAC/B,EAAPE,EAAU,OAAOF,EACpB,GAAW,EAAPE,GAA8B,iBAAVF,GAAsBA,GAASA,EAAMG,WAAY,OAAOH,EAChF,IAAII,EAAKX,OAAOY,OAAO,MAGvB,GAFA1B,EAAoBkB,EAAEO,GACtBX,OAAOC,eAAeU,EAAI,UAAW,CAAET,YAAY,EAAMK,MAAOA,IACtD,EAAPE,GAA4B,iBAATF,EAAmB,IAAI,IAAIM,KAAON,EAAOrB,EAAoBU,EAAEe,EAAIE,EAAK,SAASA,GAAO,OAAON,EAAMM,IAAQC,KAAK,KAAMD,IAC9I,OAAOF,GAIRzB,EAAoB6B,EAAI,SAAS1B,GAChC,IAAIS,EAAST,GAAUA,EAAOqB,WAC7B,WAAwB,OAAOrB,EAAgB,SAC/C,WAA8B,OAAOA,GAEtC,OADAH,EAAoBU,EAAEE,EAAQ,IAAKA,GAC5BA,GAIRZ,EAAoBa,EAAI,SAASiB,EAAQC,GAAY,OAAOjB,OAAOkB,UAAUC,eAAe1B,KAAKuB,EAAQC,IAGzG/B,EAAoBkC,EAAI,GAIjBlC,EAAoBA,EAAoBmC,EAAI,G,gBClFrDhC,EAAOD,QAAU,CAAC,aAAc,aAAc,W,wCCE9BS,EAAMyB,EAAWC,E,gBAgD3BC,GAhDU3B,EAgDO,YAhDDyB,EAgDc,EAhDHC,EAgDM,CACrCA,QADqC,SAC7BE,GACNC,IAAWC,QAAQ,SAACC,GAClBH,EAAGI,kBAAkBD,OAnDML,QAC/B,IAAIO,QAAQ,SAACC,EAASC,GACpB,IAAMC,EAAUC,UAAUC,KAAKtC,EAAMyB,GAErCW,EAAQG,gBAAkB,SAACC,GACzBd,EAAQU,EAAQK,OAAQD,EAAEE,WAAYF,EAAEG,WAAYP,EAAQQ,cAG9DR,EAAQS,QAAU,SAACL,GACjBL,EAAOK,EAAEM,OAAOL,SAGlBL,EAAQW,UAAY,SAACP,GACnBN,EAAQM,EAAEM,OAAOL,YCKRO,EApBG,SAACC,GAAD,6DAAkD,GAAlD,IAAQC,cAAR,MAAiB,MAAjB,MAAwBC,oBAAxB,MAAuC,OAAvC,SAChB,IAAIlB,QAAQ,SAACC,EAASC,GACpB,IAAMiB,EAAM,IAAIC,eAEhBD,EAAID,aAAeA,EACnBC,EAAId,KAAKY,EAAQD,GAEjBG,EAAIE,mBAAqB,WACnBF,EAAIG,aAAeF,eAAeG,OACjB,MAAfJ,EAAIK,OACNvB,EAAQkB,EAAIM,UAEZvB,EAAOiB,EAAIM,YAKjBN,EAAIO,UCjBFC,EAAgB,CAAC,IAAK,KAAM,IAAK,KAAM,IAAK,IAAK,KAAM,IAAK,KAAM,IAAK,KAAM,KAMtEC,EAAe,SAACC,GAK3B,IAJA,IAAMC,EAAMC,KAAKF,GACXG,EAAMF,EAAIG,OACVC,EAAQ,IAAIC,WAAWH,GAEpBxE,EAAI,EAAGA,EAAIwE,EAAKxE,GAAK,EAC5B0E,EAAM1E,GAAKsE,EAAIM,WAAW5E,GAG5B,OAAO0E,EAAMG,QAGFC,EAAc,SAACC,EAAQC,GAAT,OAAoB,GAAKD,EAAUC,GAEjDC,EAAa,SAACC,GACzB,IAAMH,EAASI,SAASD,EAAKE,OAAO,GAAI,IAAM,EACxCJ,EAAQb,EAAckB,QAAQH,EAAKE,MAAM,EAAGF,EAAKT,OAAS,IAEhE,OAAOK,EAAYC,EAAQC,ICE7B,SAASM,EAAeC,GACtB,OACE,EApBJ,UAAmB,UACjBjD,EAAY,aAAY,WACxBkD,EAAa,uBAAsB,OACnCC,EAAS,QAGT,qDAAwCnD,KAAakD,KAAcC,OAcvDC,CAAUH,IAEjBI,KAAMC,IAbb,SAAsBC,GACpB,IAAIC,EAAQD,EAAKR,QAAQ,mBAEzBS,EAAQD,EAAKR,QAAQ,IAAKS,GAAS,EACnC,MAAMC,EAAMF,EAAKG,YAAY,KAE7B,OAAOC,KAAKC,SAASL,EAAKT,MAAMU,EAAOC,QAOnBI,CAAaP,IAenC,MAAMQ,GHakBC,EGbqB,EAAG9E,IAAKiE,EAAYc,UAAWhE,KAC1EgD,EAAe,CAAEE,aAAYlD,cAAaqD,KAAME,IAZlD,SAAgCvD,GAC9B,MAAMiE,EAAU,IAAIC,IAOpB,OALAlE,EAAUD,QAAQ,CAACpB,EAAOM,KACxB,MAAM8C,EAASpD,EAAMwF,MAAM,KAAK,GAChCF,EAAQG,IAAIzB,EAAW1D,GAAM6C,EAAaC,MAGrCkC,GAIkDI,CA1C3D,SAAeC,GACb,OAAO,IAAIJ,IAAI9F,OAAOmG,QAAQD,IAyCkDE,CAAMjB,KHarE,SAAXkB,EAAY,GAAD,IAAGT,EAAH,EAAGA,UAAW/E,EAAd,EAAcA,IAAd,OACfW,EACGyD,KAAK,SAACxD,GAAD,OA1CW,SAACA,EAAImE,EAAW/E,GAAhB,OACrB,IAAIiB,QAAQ,SAACC,EAASC,GACpB,IAEMC,EAFcR,EAAGgB,YAAY,CAACmD,GAAY,YACtBU,YAAYV,GAChBzF,IAAIU,GAE1BoB,EAAQW,UAAY,SAACP,GACnBN,EAAQM,EAAEM,OAAOL,SAGnBL,EAAQS,QAAU,SAACL,GACjBL,EAAOK,EAAEM,OAAOL,WA+BFiE,CAAe9E,EAAImE,EAAW/E,KAC3CoE,KAAK,SAACE,GACL,OAAIA,GAEGQ,EAAS,CAAEC,YAAW/E,QAC1BoE,KAAK,SAAC3C,GAAD,OAAYd,EAAQyD,KAAK,SAACxD,GAAD,OAhCpB,SAACA,EAAImE,EAAW/E,EAAKsE,GAArB,OACnB,IAAIrD,QAAQ,SAACC,EAASC,GACpB,IAAMS,EAAchB,EAAGgB,YAAY,CAACmD,GAAY,aAC1CY,EAAQ/D,EAAY6D,YAAYV,GAEtCnD,EAAYgE,WAAa,SAACpE,GACxBN,EAAQM,IAGVI,EAAYC,QAAU,SAACL,GACrBL,EAAOK,IAGTmE,EAAME,IAAIvB,EAAMtE,KAmB6B8F,CAAalF,EAAImE,EAAW/E,EAAKyB,OACvE2C,KAAK,kBAAMoB,EAAS,CAAET,YAAW/E,cAT7B,IAAS8E,EGRxBiB,UAAY,SAASvE,GACnB,MAAM,WAAEyC,EAAU,UAAElD,GAAcS,EAAE8C,KAEpCO,EAAkB,CAAEE,UAAWhE,EAAWf,IAAKiE,IAAcG,KAAMY,IACjEgB,YAAYhB","file":"js/f354bf24618a272f02eb.worker.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 1);\n","module.exports = ['FluidR3_GM', 'MusyngKite', 'FatBoy'];\n","import soundfonts from '../../_data/soundfonts';\n\nconst openDB = (name, version, { upgrade }) =>\n  new Promise((resolve, reject) => {\n    const request = indexedDB.open(name, version);\n\n    request.onupgradeneeded = (e) => {\n      upgrade(request.result, e.oldVersion, e.newVersion, request.transaction);\n    };\n\n    request.onerror = (e) => {\n      reject(e.target.result);\n    };\n\n    request.onsuccess = (e) => {\n      resolve(e.target.result);\n    };\n  });\n\nconst getFromStorage = (db, storeName, key) =>\n  new Promise((resolve, reject) => {\n    const transaction = db.transaction([storeName], 'readonly');\n    const store = transaction.objectStore(storeName);\n    const request = store.get(key);\n\n    request.onsuccess = (e) => {\n      resolve(e.target.result);\n    };\n\n    request.onerror = (e) => {\n      reject(e.target.result);\n    };\n  });\n\nconst addToStorage = (db, storeName, key, data) =>\n  new Promise((resolve, reject) => {\n    const transaction = db.transaction([storeName], 'readwrite');\n    const store = transaction.objectStore(storeName);\n\n    transaction.oncomplete = (e) => {\n      resolve(e);\n    };\n\n    transaction.onerror = (e) => {\n      reject(e);\n    };\n\n    store.add(data, key);\n  });\n\nconst storage = openDB('soundfont', 1, {\n  upgrade(db) {\n    soundfonts.forEach((soundfont) => {\n      db.createObjectStore(soundfont);\n    });\n  },\n});\n\nexport default function(callback) {\n  const returnFn = ({ storeName, key }) =>\n    storage\n      .then((db) => getFromStorage(db, storeName, key))\n      .then((data) => {\n        if (data) return data;\n\n        return callback({ storeName, key })\n          .then((result) => storage.then((db) => addToStorage(db, storeName, key, result)))\n          .then(() => returnFn({ storeName, key }));\n      });\n\n  return returnFn;\n}\n","const httpFetch = (url, { method = 'GET', responseType = 'text' } = {}) =>\n  new Promise((resolve, reject) => {\n    const xhr = new XMLHttpRequest();\n\n    xhr.responseType = responseType;\n    xhr.open(method, url);\n\n    xhr.onreadystatechange = () => {\n      if (xhr.readyState === XMLHttpRequest.DONE) {\n        if (xhr.status === 200) {\n          resolve(xhr.response);\n        } else {\n          reject(xhr.response);\n        }\n      }\n    };\n\n    xhr.send();\n  });\n\nexport default httpFetch;\n","const PITCH_CLASSES = ['C', 'Db', 'D', 'Eb', 'E', 'F', 'Gb', 'G', 'Ab', 'A', 'Bb', 'B'];\n\nexport const clamp = (value, min, max) => {\n  return Math.min(Math.max(value, min), max);\n};\n\nexport const decodeBase64 = (base64) => {\n  const raw = atob(base64);\n  const len = raw.length;\n  const bytes = new Uint8Array(len);\n\n  for (let i = 0; i < len; i += 1) {\n    bytes[i] = raw.charCodeAt(i);\n  }\n\n  return bytes.buffer;\n};\n\nexport const pitchToMIDI = (octave, pitch) => (12 * octave) + pitch;\n\nexport const noteToMIDI = (note) => {\n  const octave = parseInt(note.slice(-1), 10) + 1;\n  const pitch = PITCH_CLASSES.indexOf(note.slice(0, note.length - 1));\n\n  return pitchToMIDI(octave, pitch);\n};\n\nconst Util = {\n  clamp,\n  decodeBase64,\n  pitchToMIDI,\n  noteToMIDI,\n};\n\nexport default Util;\n","import memoizeWithStorage from './storage';\nimport httpFetch from './httpFetch';\nimport { decodeBase64, noteToMIDI } from './Util';\n\nfunction toMap(obj) {\n  return new Map(Object.entries(obj));\n}\n\nfunction nameToUrl({\n  soundfont = 'FluidR3_GM',\n  instrument = 'acoustic_grand_piano',\n  format = 'mp3',\n}) {\n  const baseURL = 'https://gleitz.github.io';\n  return `${baseURL}/midi-js-soundfonts/${soundfont}/${instrument}-${format}.js`;\n}\n\nfunction midiJsToJson(data) {\n  let begin = data.indexOf('MIDI.Soundfont.');\n  // if (begin < 0) throw Error('Invalid MIDI.js Soundfont format')\n  begin = data.indexOf('=', begin) + 2;\n  const end = data.lastIndexOf(',');\n\n  return JSON.parse(`${data.slice(begin, end)}}`);\n}\n\nfunction fetchSoundfont(options) {\n  return (\n    httpFetch(nameToUrl(options))\n      // .then((result) => result.text())\n      .then((text) => midiJsToJson(text))\n  );\n}\n\nfunction soundfontToArrayBuffer(soundfont) {\n  const buffers = new Map();\n\n  soundfont.forEach((value, key) => {\n    const base64 = value.split(',')[1];\n    buffers.set(noteToMIDI(key), decodeBase64(base64));\n  });\n\n  return buffers;\n}\n\nconst memoizedSoundfont = memoizeWithStorage(({ key: instrument, storeName: soundfont }) =>\n  fetchSoundfont({ instrument, soundfont }).then((data) => soundfontToArrayBuffer(toMap(data))),\n);\n\n// eslint-disable-next-line func-names\nonmessage = function(e) {\n  const { instrument, soundfont } = e.data;\n\n  memoizedSoundfont({ storeName: soundfont, key: instrument }).then((buffers) => {\n    postMessage(buffers);\n  });\n};\n"],"sourceRoot":""}